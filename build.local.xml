<project name="local" default="help">
  <target name="help">

    <echo message="${project.name} ${project.version}: specific:"/>
    <echo message=""/>
    <echo message="  php-cs-fix"/>
    <echo message="    Run php-cs-fix"/>
    <echo message=""/>
    <echo message="  build-phar"/>
    <echo message="    Build local ${project.shortName}.phar"/>
    <echo message=""/>
    <echo message="  composer-install"/>
    <echo message="    Run Composer"/>
    <echo message=""/>
    <echo message="  file-version"/>
    <echo message="    File the version to file"/>
 </target>

  <!-- php-cs-fix -->
  <target name="php-cs-fix">
    <exec command="php-cs-fixer fix ./src" logoutput="true" checkreturn="true" />
  </target>

  <!-- build-phar -->
  <target name="build-phar">
    <property name="project.pharfilename" value="${project.shortName}-${project.version}.phar" />

    <exec command="./src/bin/compile ${project.version}" logoutput="true" checkreturn="true" />

    <symlink target="${project.basedir}/dist/${project.pharfilename}" link="${project.basedir}/dist/${project.shortName}.phar" overwrite="true" />

    <exec command="php ${project.basedir}/dist/${project.pharfilename} -t" logoutput="true" checkreturn="true" />

    <echo>${project.pharfilename} has been created and tested!</echo>
  </target>

  <!-- composer-install -->
  <target name="composer-install">
      <composer command="install"/>
  </target>

  <!-- file-version -->
  <target name="file-version">
        <version releasetype="bugfix" file="version.txt" property="version.number"/>
  </target>

  <!-- full-release -->
  <target name="full-release">
    <property name="project.pharfilename" value="${project.shortName}-${project.version}.phar" />
    <tstamp>
        <format property="build.time" pattern="%Y%m%d%H%I%S" />
        <format property="newdeploy.date" pattern="%Y-%m-%d %H:%I:%S" />
    </tstamp>
    <property name="phar.arc" value="${project.basedir}/../phar.dev/archives" />

    <copy file="${project.basedir}/dist/${project.pharfilename}" tofile="${phar.arc}/${project.pharfilename}" overwrite="true"/>
    <symlink target="${phar.arc}/${project.pharfilename}" link="${phar.arc}/${project.shortName}.phar" overwrite="true"/>

    <echo>${project.pharfilename} has been created</echo>

    <mail tolist="franck@cassedanne.com" from="franck@info.com" subject="${project.pharfilename} build complete">
      The build process is a success...
    </mail>
  </target>

  <target name="announce">
    <property name="project.pharfilename" value="${project.shortName}-${project.version}.phar" />

    <mail tolist="franck@info.com,jspalink@info.com,mstockbridge@info.com,iknox@info.com,bcicenas@info.com,bfritton@info.com,vvondrakk@info.com" from="franck@info.com" subject="${project.pharfilename} is out">The build process for ${project.pharfilename} is complete.

      Run this in your terminal to upgrade to the latest version:
      $ php path_to/${project.shortName}.phar --selfupdate

      Manual download available at:
      - http://api.ouarz.net/v1/download/apix.phar

      Previous version are listed there:
      - http://api.ouarz.net/v1/versions/apix.phar
      And are downloadable using a similar format as:
      - http://api.ouarz.net/v1/download/${project.pharfilename}

      Changelog available at:
      - http://api.ouarz.net/v1/download/changelog/apix.phar

      Github repo available at:
      - https://github.com/frqnck/apix

    </mail>

  </target>

</project>

<!-- vim: set tabstop=2 shiftwidth=2 expandtab: -->
